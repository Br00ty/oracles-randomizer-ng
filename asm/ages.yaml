addrs:
  # hram
  hMusicVar: 0xffb7 # used in filterMusic

  # wram
  wEssencesObtained: 0xc6bf
  wMakuTreeState: 0xc6e8
  wActiveGroup: 0xcc2d
  wActiveRoom: 0xcc30

  # rom 00
  forceEnableIntroInputs: 0x0886

banks:
  0x00:
    # return z iff the current group and room match c and b.
    - compareRoom: |
        ld a,(wActiveGroup)
        cp c
        ret nz
        ld a,(wActiveRoom)
        cp b
        ret
    # read 2 bytes from bank e at hl into bc.
    # TODO: these (ff97)s could be replaced with (ff00+97)s
    - readWord: |
        ld a,(ff97)
        push af
        ld a,e
        ld (ff97),a
        ld (2222),a
        ldi a,(hl)
        ld b,a
        ld a,(hl)
        ld c,a
        pop af
        ld (ff97),a
        ld (2222),a
        ret
    # searches for a value in a table starting at hl, with an entry matching
    # keys b and subkey c, and values e bytes long. sets c if found. a key of
    # ff ends the table.
    - searchDoubleKey: |
        ldi a,(hl)
        cp a,ff
        ret z
        cp b
        jr nz,06
        ldi a,(hl)
        cp c
        jr nz,03
        scf
        ret
        inc hl
        ld a,e
        rst 10
        jr ee
    # searches for an interaction with ID a and returns the ID address in de,
    # and z flag if found.
    - findObjectWithId: |
        push bc
        ld b,a
        ld de,d041
        ld a,(de)
        cp b
        jr nz,02
        pop bc
        ret
        inc d
        ld a,d
        cp a,e0
        jr c,f4
        pop bc
        or a
        ret
    # only increment the maku tree's state if on the maku tree screen, or if
    # all essences are obtained, set it to the value it would normally have at
    # that point in the game. this allows getting the maku tree's item as long
    # as you haven't collected all essences.
    - checkMakuState: |
        ld a,(wActiveGroup)
        cp a,02
        jr nc,0e
        ld a,(wActiveRoom)
        cp a,38
        jr nz,07
        ld a,(wMakuTreeState)
        inc a
        cp a,11
        ret
        ld a,(wEssencesObtained)
        inc a
        scf
        jr nz,03
        ld a,0e
        ret
        ld a,(wMakuTreeState)
        ret
  0x03:
    - initialGlobalFlags: |
        db 0a,0c,1d,20,23,2b,33,3d,40,41,43,45,ff
